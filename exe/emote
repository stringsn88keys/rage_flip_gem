#!/usr/bin/env ruby

require_relative "../lib/rage_flip"

if ARGV.length == 0
  puts RageFlip::Emote.list_emotes
  exit 0
end

# Handle single argument commands
if ARGV.length == 1
  case ARGV[0].downcase
  when "list"
    puts RageFlip::Emote.list_emotes
    exit 0
  when "list-custom"
    puts RageFlip::Emote.list_custom_emotes
    exit 0
  when "init-custom"
    puts RageFlip::Emote.init_custom_config
    exit 0
  when "categories"
    puts RageFlip::Emote.list_categories
    exit 0
  when "help", "-h", "--help"
    puts RageFlip::Emote.show_help
    exit 0
  end
end

# Handle two argument commands
if ARGV.length == 2 && ARGV[0].downcase == "category"
  puts RageFlip::Emote.list_category(ARGV[1])
  exit 0
end

# Process multiple emote arguments
results = []
unknown_emotes = []

ARGV.each do |arg|
  emote_name = arg.downcase
  result = RageFlip::Emote.process(emote_name)
  
  if result
    results << result
  else
    unknown_emotes << emote_name
  end
end

if unknown_emotes.any?
  puts "Unknown emote(s): #{unknown_emotes.join(', ')}"
  puts ""
  puts RageFlip::Emote.list_emotes
  exit 1
end

if results.any?
  # Concatenate all results with no spaces
  final_result = results.join("")
  
  # Copy to clipboard
  if RageFlip::Clipboard.copy(final_result)
  else
    puts "Failed to copy to clipboard, but here's your emote:"
  end
  puts final_result
else
  puts "No valid emotes found"
  exit 1
end
